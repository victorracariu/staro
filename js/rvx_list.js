function HandleAdd(){if(rvxLookupField){Ext.Rvx.PopupWindow(rvxGridUrl+"add/",rvxFormWidth,rvxFormHeight)}else{var a=Math.floor(Math.random()*1000);window.open(rvxGridUrl+"add/","blank"+a)}}function HandleOpen(){var b=rvxGrid.getSelectionModel().getSelected();if(b){if(rvxLookupField){Ext.Rvx.PopupWindow(rvxGridUrl+"view/id/"+b.get("Id"),rvxFormWidth,rvxFormHeight)}else{var a=Math.floor(Math.random()*1000);window.open(rvxGridUrl+"view/id/"+b.get("Id"),"blank"+a)}}else{Ext.Rvx.ShowInfo(rvx_locale.txtWarning,rvx_locale.txtSelectRecord)}}function HandleDelete(){var a=rvxGrid.getSelectionModel().getSelected();if(a){Ext.MessageBox.confirm(rvx_locale.txtConfirm,rvx_locale.txtDeleteConfirm,ProcessDelete)}else{Ext.Rvx.ShowInfo(rvx_locale.txtWarning,rvx_locale.txtSelectRecord)}}function ProcessDelete(a){if(a=="no"){return false}var b=rvxGrid.getSelectionModel().getSelected();rvxGrid.el.mask(rvx_locale.txtDelete,"x-mask-loading");Ext.Ajax.request({url:rvxGridUrl+"delete/",params:{task:"delete",id:b.get("Id"),key:"id"},failure:function(c,d){rvxGrid.el.unmask();Ext.Rvx.ShowError(c.responseText)},success:function(c,d){rvxGrid.el.unmask();try{Ext.decode(c.responseText)}catch(g){Ext.Rvx.ShowError(c.responseText);return false}var f=rvxGrid.getSelectionModel().getSelected();rvxGrid.getStore().remove(f)}})}function HandleSearch(){rvxGrid.getStore().baseParams=rvxParams;rvxGrid.getStore().baseParams.searchcol=Ext.getCmp("edtSearchField").getValue();rvxGrid.getStore().baseParams.searchval=Ext.getCmp("edtSearchValue").getValue();rvxGrid.getStore().reload()}function HandleSelectValue(){var c=rvxGrid.getSelectionModel().getSelected();if(c){var b=c.get(rvxLookupField);if(window.opener&&!window.opener.closed){var a=window.opener.document.getElementById(rvxLookupTrigger);if(a){a.value=b;window.opener.TriggerValidate(a)}window.close()}else{Ext.Rvx.ShowWarning(rvx_locale.txtParentWndClosed)}}else{Ext.Rvx.ShowWarning(rvx_locale.txtSelectRecord)}}function HandleSelectClose(){window.close()}function loadFailed(d,c,a,b){if(a.responseText){Ext.Rvx.ShowError(a.responseText)}}function loadSuccess(b,a,c){rvxGrid.getSelectionModel().selectFirstRow()}function rvxRunList(){var c=new Ext.data.SimpleStore({fields:["SeachField"],data:rvxSearchCols});var e=new Ext.data.SimpleStore({fields:["SeachValue"],data:rvxSearchCols});var i=new Ext.form.ComboBox({id:"edtSearchField",store:c,displayField:"SeachField",typeAhead:true,forceSelection:true,mode:"local",triggerAction:"all",emptyText:"Search field",value:rvxSearchFirst,selectOnFocus:true,width:170});var d=new Ext.form.ComboBox({id:"edtSearchValue",store:e,displayField:"SearchValue",typeAhead:true,mode:"local",triggerAction:"all",emptyText:"",selectOnFocus:true,width:170});var f=new Ext.Toolbar({items:[{text:rvx_locale.txtAdd,icon:"img/new.png",cls:"x-btn-text-icon",handler:HandleAdd},{text:rvx_locale.txtOpen,icon:"img/edit.png",cls:"x-btn-text-icon",handler:HandleOpen},{text:rvx_locale.txtDelete,icon:"img/delete.png",cls:"x-btn-text-icon",handler:HandleDelete},"-",i," ",d," ",{text:rvx_locale.txtSearch,icon:"img/search.png",cls:"x-btn-text-icon",handler:HandleSearch},"-",{text:rvx_locale.txtActions,icon:"img/action.png",iconCls:"bmenu",menu:rvxActionMenus}]});var h=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:rvxGridUrl+"fetch/",method:"POST"}),reader:rvxReader,baseParams:rvxParams,sortInfo:{field:"0",direction:"DESC"},remoteSort:true});h.on("loadexception",loadFailed);h.on("load",loadSuccess);rvxTriggerStore=h;rvxGrid=new Ext.grid.GridPanel({title:rvxGridTitle,region:"center",colModel:rvxModel,store:h,selModel:new Ext.grid.RowSelectionModel({singleSelect:true}),border:false,frame:false,loadMask:true,tbar:f,view:new Ext.grid.GroupingView(),plugins:rvxFilters,bbar:new Ext.PagingToolbar({store:h,displayInfo:true,displayMsg:"Records {0} - {1} of {2}",emptyMsg:"The list is empty",pageSize:rvxGridPageSize})});if(rvxLookupField){rvxGrid.addListener("rowdblclick",HandleSelectValue)}else{rvxGrid.addListener("rowdblclick",HandleOpen)}var b=new Ext.form.FormPanel({region:"south",layout:"border",frame:true,items:[{type:"hidden"}]});b.addButton("OK",HandleSelectValue);b.addButton(rvx_locale.txtCancel,HandleSelectClose);if(rvxLookupField){var a=new Ext.Viewport({layout:"border",border:false,items:[rvxGrid,b]})}else{var a=new Ext.Viewport({layout:"border",border:false,items:[rvxGrid]})}var j=new Ext.KeyMap("edtSearchValue",{key:13,fn:HandleSearch});var j=new Ext.KeyMap("edtSearchField",{key:13,fn:HandleSearch});Ext.get("edtSearchValue").focus();var g=new Ext.KeyMap(document);g.accessKey=function(k,n,m){var l=function(p,o){o.preventDefault();n.call(m||this,p,o)};this.on(k,l,m)};g.accessKey({key:"a",alt:true},HandleAdd,this);g.accessKey({key:"e",alt:true},HandleOpen,this);g.accessKey({key:"t",alt:true},HandleDelete,this);g.accessKey({key:"s",alt:true},function(){edtSearchValue.focus()},this);g.accessKey({key:"f",alt:true},function(){rvxGrid.getSelectionModel().selectFirstRow();rvxGrid.getView().focusEl.focus()},this);h.load({params:{start:0,limit:rvxGridPageSize}})};