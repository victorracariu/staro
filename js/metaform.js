Ext.ux.clone=function(d){if(!d||"object"!==typeof d){return d}var e="function"===typeof d.pop?[]:{};var b,a;for(b in d){if(d.hasOwnProperty(b)){a=d[b];if(a&&"object"===typeof a){e[b]=Ext.ux.clone(a)}else{e[b]=a}}}return e};Ext.ux.MetaTabsForm=Ext.extend(Ext.form.FormPanel,{loadingText:"Loading",savingText:"Saving",autoInit:true,tabPanelConfig:{xtype:"tabpanel",border:false,anchor:"100% 100%",deferredRender:false,layoutOnTabChange:true,defaults:{layout:"form",hideMode:"offsets"}},formConfig:{},initComponent:function(){config={items:{}};Ext.apply(this,config);Ext.apply(this.initialConfig,config);Ext.ux.MetaTabsForm.superclass.initComponent.apply(this,arguments);this.form.on({beforeaction:{scope:this,fn:this.beforeAction},actioncomplete:{scope:this,fn:function(a,b){if(b.result.metaData==undefined){Ext.Rvx.ShowError(b.result)}else{if("load"===b.type&&b.result.metaData){this.onMetaChange(this,b.result.metaData)}else{if("submit"===b.type){this.updateBoundData()}}}}}});this.form.trackResetOnLoad=true},onRender:function(){Ext.ux.MetaTabsForm.superclass.onRender.apply(this,arguments);this.form.waitMsgTarget=this.el;if(true===this.autoInit){this.load({params:{meta:true}})}else{if("object"===typeof this.autoInit){this.load(this.autoInit)}}},beforeAction:function(a,b){b.success=function(f){try{var g=Ext.decode(f.responseText)}catch(h){Ext.Rvx.ShowError(f.responseText);return false}var d=this.processResponse(f);if(d===true||!d.success||!d.data){this.failureType=Ext.form.Action.LOAD_FAILURE;this.form.afterAction(this,false);return}this.form.afterAction(this,true);this.form.clearInvalid();this.form.setValues(d.data);var c=Ext.getCmp("PeriodFrom");if(c){c.setValue(d.data.PeriodFrom)}var c=Ext.getCmp("PeriodTo");if(c){c.setValue(d.data.PeriodTo)}}},onMetaChange:function(form,meta){this.removeAll();var tabPanelConfig=Ext.apply(Ext.ux.clone(this.tabPanelConfig),meta.tabPanelConfig||{});Ext.apply(tabPanelConfig.defaults,meta.tabPanelConfig.defaults||{},this.tabPanelConfig.defaults);var formConfig=Ext.apply(Ext.ux.clone(this.formConfig),meta.formConfig||{});Ext.apply(formConfig.defaults,meta.formConfig.defaults||{},this.formConfig.defaults);Ext.each(tabPanelConfig.items,function(tab){var columnCount=tab.columnCount||tabPanelConfig.columnCount||1;var columnWidth=1/columnCount;var colPanel={xtype:"panel",border:false,layout:"column",defaults:Ext.apply(Ext.ux.clone(formConfig),tab.formConfig||{},{border:false,layout:"form",columnWidth:columnWidth}),items:function(){var cols=[];for(var i=0;i<columnCount;i++){cols.push({items:[]})}return cols}()};var colIndex=0;var tabIndex=1;Ext.each(tab.fields,function(field){field.tabIndex=tabIndex++;if(field.xtype=="trigger"){field.onTriggerClick=eval("SelectParam")}colPanel.items[colIndex].items.push(field);colIndex++;colIndex=colIndex===columnCount?0:colIndex});delete (tab.fields);tab.items=Ext.ux.clone(colPanel);Ext.each(tab.items.items,function(col){col.listeners={add:{scope:this,fn:this.onAdd}}},this)},this);this.add(tabPanelConfig);this.doLayout();this.afterMetaChange(form,meta)},removeAll:function(){this.items.each(this.remove,this);this.form.items.clear()},afterMetaChange:Ext.emptyFn});Ext.reg("metatabsform",Ext.ux.MetaTabsForm);